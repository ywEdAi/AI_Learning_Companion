{"ast":null,"code":"import React,{useReducer,useEffect,useCallback,useState}from\"react\";import{Streamlit}from\"streamlit-component-lib\";import{useRenderData}from\"../utils/StreamlitProvider\";import{ActionTypes}from\"../types/labelerTypes\";import{initialState,reducer}from\"../reducers/labelerReducer\";import{adjustSelectionBounds,getCharactersCountUntilNode,isLabeled,removeLabelData}from\"../helpers/labelerHelpers\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Labeler=()=>{const{args}=useRenderData();const[labelName,setLabelName]=useState(\"\");const[state,dispatch]=useReducer(reducer,initialState);useEffect(()=>{const fetchData=async()=>{const{text,labels,in_snake_case}=args;dispatch({type:ActionTypes.SET_TEXT_LABELS,payload:{text,labels,in_snake_case}});dispatch({type:ActionTypes.RENDER_TEXT});Streamlit.setComponentValue(labels);};fetchData();},[]);useEffect(()=>{dispatch({type:ActionTypes.RENDER_TEXT});},[state.labels,state.selectedLabel]);const handleMouseUp=useCallback(async()=>{var _document$getSelectio;if(!state.selectedLabel)return;const selection=(_document$getSelectio=document.getSelection())===null||_document$getSelectio===void 0?void 0:_document$getSelectio.getRangeAt(0);if(selection&&selection.toString().trim()!==\"\"){const container=document.getElementById(\"actual-text\");const charsBeforeStart=getCharactersCountUntilNode(selection.startContainer,container);const charsBeforeEnd=getCharactersCountUntilNode(selection.endContainer,container);const finalStartIndex=selection.startOffset+charsBeforeStart;const finalEndIndex=selection.endOffset+charsBeforeEnd;const textContent=(container===null||container===void 0?void 0:container.textContent)||\"\";const{start,end}=adjustSelectionBounds(textContent,finalStartIndex,finalEndIndex);const selectedText=textContent.slice(start,end);if(isLabeled(finalStartIndex,finalEndIndex,state.labels[state.selectedLabel])){const labels=removeLabelData(start,end,state.labels[state.selectedLabel]);const newLabels={...state.labels};newLabels[state.selectedLabel]=labels;dispatch({type:ActionTypes.SET_TEXT_LABELS,payload:{text:state.text,labels:newLabels,in_snake_case:state.in_snake_case}});}else{const label={start,end,label:selectedText};const newLabels={...state.labels};newLabels[state.selectedLabel]=[...newLabels[state.selectedLabel],label];dispatch({type:ActionTypes.SET_TEXT_LABELS,payload:{text:state.text,labels:newLabels,in_snake_case:state.in_snake_case}});}}},[state,dispatch]);const addLabel=name=>{if(name.trim()===\"\")return;setLabelName(\"\");dispatch({type:ActionTypes.ADD_LABEL,payload:name});};const selectLabel=name=>{dispatch({type:ActionTypes.SELECT_LABEL,payload:name});};const removeLabel=name=>{dispatch({type:ActionTypes.REMOVE_LABEL,payload:name});};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-row flex-wrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap justify-between items-center cursor-pointer mr-2 mb-2 pr-3 rounded text-white text-base bg-primary hover:bg-secondary\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Enter Label Name\",className:\"text-black p-1 mr-2 focus:outline-none border border-secondary\",onChange:e=>setLabelName(e.target.value),value:labelName}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>addLabel(labelName),children:\"Add Label\"})]}),Object.keys(state.labels).map((label,index)=>/*#__PURE__*/_jsxs(\"span\",{className:\"flex flex-wrap justify-between items-center cursor-pointer py-1 px-3 mr-2 mb-2 rounded text-base\"+(state.selectedLabel===label?\" bg-primary hover:bg-secondary text-white\":\" border border-primary text-primary hover:bg-primary hover:text-white\"),onClick:()=>selectLabel(label),children:[label,/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-5 w-5 ml-3 hover:text-gray-300\",viewBox:\"0 0 20 20\",fill:\"currentColor\",onClick:()=>removeLabel(label),children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\"})})]},index))]}),/*#__PURE__*/_jsx(\"div\",{id:\"actual-text\",className:\"mt-5 h-full\",onMouseUp:handleMouseUp,children:state.actual_text})]});};export default Labeler;","map":{"version":3,"names":["React","useReducer","useEffect","useCallback","useState","Streamlit","useRenderData","ActionTypes","initialState","reducer","adjustSelectionBounds","getCharactersCountUntilNode","isLabeled","removeLabelData","jsx","_jsx","jsxs","_jsxs","Labeler","args","labelName","setLabelName","state","dispatch","fetchData","text","labels","in_snake_case","type","SET_TEXT_LABELS","payload","RENDER_TEXT","setComponentValue","selectedLabel","handleMouseUp","_document$getSelectio","selection","document","getSelection","getRangeAt","toString","trim","container","getElementById","charsBeforeStart","startContainer","charsBeforeEnd","endContainer","finalStartIndex","startOffset","finalEndIndex","endOffset","textContent","start","end","selectedText","slice","newLabels","label","addLabel","name","ADD_LABEL","selectLabel","SELECT_LABEL","removeLabel","REMOVE_LABEL","children","className","placeholder","onChange","e","target","value","onClick","Object","keys","map","index","xmlns","viewBox","fill","fillRule","d","id","onMouseUp","actual_text"],"sources":["/Users/yiwang/Documents/ChatYoutube/streamlit-annotation-tools/src/streamlit_annotation_tools/frontend/src/components/Labeler.tsx"],"sourcesContent":["import React, { useReducer, useEffect, useCallback, useState } from \"react\"\nimport { Streamlit } from \"streamlit-component-lib\"\nimport { useRenderData } from \"../utils/StreamlitProvider\"\nimport { ActionTypes, IAction, IState } from \"../types/labelerTypes\"\nimport { initialState, reducer } from \"../reducers/labelerReducer\"\nimport { adjustSelectionBounds, getCharactersCountUntilNode, isLabeled, removeLabelData } from \"../helpers/labelerHelpers\"\n\nconst Labeler: React.FC = () => {\n  const { args } = useRenderData()\n  const [labelName, setLabelName] = useState<string>(\"\")\n  const [state, dispatch] = useReducer<React.Reducer<IState, IAction>>(\n    reducer,\n    initialState\n  )\n\n  useEffect(() => {\n    const fetchData = async () => {\n      const { text, labels, in_snake_case } = args\n      dispatch({ type: ActionTypes.SET_TEXT_LABELS, payload: { text, labels, in_snake_case } })\n      dispatch({ type: ActionTypes.RENDER_TEXT })\n      Streamlit.setComponentValue(labels)\n    }\n\n    fetchData()\n  }, [])\n\n  useEffect(() => {\n    dispatch({ type: ActionTypes.RENDER_TEXT })\n  }, [state.labels, state.selectedLabel])\n\n  const handleMouseUp = useCallback(async () => {\n    if (!state.selectedLabel) return\n    const selection = document.getSelection()?.getRangeAt(0);\n\n    if (selection && selection.toString().trim() !== \"\") {\n      const container = document.getElementById(\"actual-text\");\n      const charsBeforeStart = getCharactersCountUntilNode(selection.startContainer, container);\n      const charsBeforeEnd = getCharactersCountUntilNode(selection.endContainer, container);\n\n      const finalStartIndex = selection.startOffset + charsBeforeStart;\n      const finalEndIndex = selection.endOffset + charsBeforeEnd;\n\n      const textContent = container?.textContent || \"\";\n\n      const { start, end } = adjustSelectionBounds(textContent, finalStartIndex, finalEndIndex);\n      const selectedText = textContent.slice(start, end);\n\n      if (isLabeled(finalStartIndex, finalEndIndex, state.labels[state.selectedLabel])) {\n        const labels = removeLabelData(start, end, state.labels[state.selectedLabel]);\n        const newLabels = { ...state.labels };\n        newLabels[state.selectedLabel] = labels;\n        dispatch({ type: ActionTypes.SET_TEXT_LABELS, payload: { text: state.text, labels: newLabels, in_snake_case: state.in_snake_case } });\n      } else {\n        const label = { start, end, label: selectedText };\n        const newLabels = { ...state.labels };\n        newLabels[state.selectedLabel] = [...newLabels[state.selectedLabel], label];\n        dispatch({ type: ActionTypes.SET_TEXT_LABELS, payload: { text: state.text, labels: newLabels, in_snake_case: state.in_snake_case } });\n      }\n    }\n  }, [state, dispatch]);\n\n  const addLabel = (name: string) => {\n    if (name.trim() === \"\") return\n\n    setLabelName(\"\")\n    dispatch({ type: ActionTypes.ADD_LABEL, payload: name })\n  }\n\n  const selectLabel = (name: string) => {\n    dispatch({ type: ActionTypes.SELECT_LABEL, payload: name })\n  }\n\n  const removeLabel = (name: string) => {\n    dispatch({ type: ActionTypes.REMOVE_LABEL, payload: name })\n  }\n\n  return (\n    <div>\n      <div className=\"flex flex-row flex-wrap\">\n        <div className=\"flex flex-wrap justify-between items-center cursor-pointer mr-2 mb-2 pr-3 rounded text-white text-base bg-primary hover:bg-secondary\">\n          <input\n            type=\"text\"\n            placeholder=\"Enter Label Name\"\n            className=\"text-black p-1 mr-2 focus:outline-none border border-secondary\"\n            onChange={(e) => setLabelName(e.target.value)}\n            value={labelName}\n          />\n          <button onClick={() => addLabel(labelName)}>Add Label</button>\n        </div>\n\n        {Object.keys(state.labels).map((label, index) => (\n          <span\n            key={index}\n            className={\n              \"flex flex-wrap justify-between items-center cursor-pointer py-1 px-3 mr-2 mb-2 rounded text-base\" +\n              (state.selectedLabel === label\n                ? \" bg-primary hover:bg-secondary text-white\"\n                : \" border border-primary text-primary hover:bg-primary hover:text-white\")\n            }\n            onClick={() => selectLabel(label)}\n          >\n            {label}\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              className=\"h-5 w-5 ml-3 hover:text-gray-300\"\n              viewBox=\"0 0 20 20\"\n              fill=\"currentColor\"\n              onClick={() => removeLabel(label)}\n            >\n              <path\n                fillRule=\"evenodd\"\n                d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\"\n              />\n            </svg>\n          </span>\n        ))}\n      </div>\n      <div id=\"actual-text\" className=\"mt-5 h-full\" onMouseUp={handleMouseUp}>\n        {state.actual_text}\n      </div>\n    </div>\n  )\n}\n\nexport default Labeler\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}