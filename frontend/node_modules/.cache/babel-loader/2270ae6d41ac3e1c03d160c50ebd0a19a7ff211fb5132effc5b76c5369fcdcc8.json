{"ast":null,"code":"import{Streamlit}from\"streamlit-component-lib\";import{ActionTypes}from\"../types/labelerTypes\";import React from\"react\";import{formatKeys}from\"../helpers/labelerHelpers\";// Define the initial state of the component\nimport{jsx as _jsx}from\"react/jsx-runtime\";export const initialState={text:\"\",actual_text:[],labels:{},selectedLabel:\"\",in_snake_case:false};// Reducer function to handle state transitions\nexport const reducer=(state,action)=>{var _labels$selectedLabel;switch(action.type){case ActionTypes.SET_TEXT_LABELS:Streamlit.setComponentValue(formatKeys(action.payload.labels,action.payload.in_snake_case));return{...state,in_snake_case:action.payload.in_snake_case,text:action.payload.text,labels:action.payload.labels};case ActionTypes.RENDER_TEXT:const{text,labels}=state;const actual_text=[];let start=0;let selectedLabel=state.selectedLabel;if(!selectedLabel){if(Object.keys(labels).length>0){selectedLabel=Object.keys(labels)[0];}else{return{...state,actual_text:[/*#__PURE__*/_jsx(\"p\",{children:text},\"default-text\")]};}}if(!labels[selectedLabel]){selectedLabel=Object.keys(labels)[Object.keys(labels).length-1];}(_labels$selectedLabel=labels[selectedLabel])===null||_labels$selectedLabel===void 0?void 0:_labels$selectedLabel.sort((a,b)=>a.start-b.start).forEach((label,index)=>{actual_text.push(/*#__PURE__*/_jsx(\"span\",{children:text.substring(start,label.start)},\"unlabeled-\".concat(index)));actual_text.push(/*#__PURE__*/_jsx(\"span\",{className:\"labeled border border-primary bg-primary/20\",children:text.substring(label.start,label.end)},\"labeled-\".concat(index)));start=label.end;});actual_text.push(/*#__PURE__*/_jsx(\"span\",{children:text.substring(start)},\"unlabeled-end\"));Streamlit.setComponentValue(formatKeys(labels,state.in_snake_case));return{...state,actual_text,selectedLabel};case ActionTypes.ADD_LABEL:const newLabels={...state.labels};// strip whitespace\nnewLabels[action.payload.trim()]=[];return{...state,labels:newLabels,selectedLabel:action.payload};case ActionTypes.SELECT_LABEL:return{...state,selectedLabel:action.payload};case ActionTypes.REMOVE_LABEL:const updatedLabels={...state.labels};delete updatedLabels[action.payload];return{...state,labels:updatedLabels};default:return state;}};","map":{"version":3,"names":["Streamlit","ActionTypes","React","formatKeys","jsx","_jsx","initialState","text","actual_text","labels","selectedLabel","in_snake_case","reducer","state","action","_labels$selectedLabel","type","SET_TEXT_LABELS","setComponentValue","payload","RENDER_TEXT","start","Object","keys","length","children","sort","a","b","forEach","label","index","push","substring","concat","className","end","ADD_LABEL","newLabels","trim","SELECT_LABEL","REMOVE_LABEL","updatedLabels"],"sources":["/Users/yiwang/Documents/ChatYoutube/streamlit-annotation-tools/src/streamlit_annotation_tools/frontend/src/reducers/labelerReducer.tsx"],"sourcesContent":["import { Streamlit } from \"streamlit-component-lib\"\nimport { ActionTypes, IAction, IState } from \"../types/labelerTypes\"\nimport React from \"react\"\nimport { formatKeys } from \"../helpers/labelerHelpers\"\n\n// Define the initial state of the component\nexport const initialState: IState = {\n  text: \"\",\n  actual_text: [],\n  labels: {},\n  selectedLabel: \"\",\n  in_snake_case: false,\n}\n\n// Reducer function to handle state transitions\nexport const reducer = (state: IState, action: IAction): IState => {\n  switch (action.type) {\n    case ActionTypes.SET_TEXT_LABELS:\n      Streamlit.setComponentValue(formatKeys(action.payload.labels, action.payload.in_snake_case))\n\n      return {\n        ...state,\n        in_snake_case: action.payload.in_snake_case,\n        text: action.payload.text,\n        labels: action.payload.labels,\n      }\n\n    case ActionTypes.RENDER_TEXT:\n      const { text, labels } = state\n      const actual_text: JSX.Element[] = []\n      let start = 0\n      let selectedLabel = state.selectedLabel\n\n      if (!selectedLabel) {\n        if (Object.keys(labels).length > 0) {\n          selectedLabel = Object.keys(labels)[0]\n        } else {\n          return {\n            ...state,\n            actual_text: [<p key={\"default-text\"}>{text}</p>]\n          }\n        }\n      }\n\n      if (!labels[selectedLabel]) {\n        selectedLabel = Object.keys(labels)[Object.keys(labels).length - 1]\n      }\n\n      labels[selectedLabel]\n        ?.sort((a, b) => a.start - b.start)\n        .forEach((label, index) => {\n          actual_text.push(\n            <span key={`unlabeled-${index}`}>\n              {text.substring(start, label.start)}\n            </span>\n          )\n          actual_text.push(\n            <span\n              key={`labeled-${index}`}\n              className=\"labeled border border-primary bg-primary/20\"\n            >\n              {text.substring(label.start, label.end)}\n            </span>\n          )\n          start = label.end\n        })\n      actual_text.push(\n        <span key=\"unlabeled-end\">{text.substring(start)}</span>\n      )\n      Streamlit.setComponentValue(formatKeys(labels, state.in_snake_case))\n      return {\n        ...state,\n        actual_text,\n        selectedLabel,\n      }\n\n    case ActionTypes.ADD_LABEL:\n      const newLabels = { ...state.labels }\n      // strip whitespace\n      newLabels[action.payload.trim()] = []\n\n      return {\n        ...state,\n        labels: newLabels,\n        selectedLabel: action.payload,\n      }\n\n    case ActionTypes.SELECT_LABEL:\n      return {\n        ...state,\n        selectedLabel: action.payload,\n      }\n\n    case ActionTypes.REMOVE_LABEL:\n      const updatedLabels = { ...state.labels }\n      delete updatedLabels[action.payload]\n\n      return {\n        ...state,\n        labels: updatedLabels\n      }\n\n    default:\n      return state\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}